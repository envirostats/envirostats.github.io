<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Stefan Schreiber" />


<title>Regular expressions and simple models</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">EXGEN 5449</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="day1.html">Day 1</a>
</li>
<li>
  <a href="day2.html">Day 2</a>
</li>
<li>
  <a href="day3.html">Day 3</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Regular expressions and simple models</h1>
<h3 class="subtitle">EXGEN5449 - Winter 2020</h3>
<h4 class="author">Stefan Schreiber</h4>

</div>


<script>
$(document).ready(function() {
  $items = $('div#TOC li');
  $items.each(function(idx) {
    num_ul = $(this).parentsUntil('#TOC').length;
    $(this).css({'text-indent': num_ul * 10, 'padding-left': 0});
  });

});
</script>
<style type="text/css">
.red { 
  color: red;
  padding-top: 0;
  margin-top: -20px;
  border-top-color: #f5f5f5;
}
</style>
<div id="regular-expressions" class="section level1">
<h1><span class="header-section-number">1</span> Regular expressions</h1>
<p>As we saw yesterday regular expressions can save you a lot of time, if you put some effort into understanding how they work. They certainly look intimidating at first but you get used to it. For today we keep on working with regular expressions a bit more because I found a great R Studio Addin that helps you understanding them and get a taste for what is possible! The package is currently only available on GitHub. In order to download packages from GitHub you first need to download the <code>devtools</code> package. Once you have downloaded it, you can install packages straight from GitHub. The package we will using is called regexplain and can be found <a href="https://github.com/gadenbuie/regexplain">here</a>. Have a look at the README file. To install the package run:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;gadenbuie/regexplain&quot;</span>)</a></code></pre></div>
<p>Now you will have <code>REGEXPLAIN</code> in your <code>Addins</code> drop down menu (below the <code>Tools</code> menu). Another great resource for testing your regular expressions are these two website: <a href="https://regex101.com/" class="uri">https://regex101.com/</a> and <a href="https://www.regular-expressions.info/" class="uri">https://www.regular-expressions.info/</a></p>
<p>I also wanted to share with you the regex example I showed you yesterday. Instead of sending or downloading CSV files, you could also read out the data frame you are working with using the <code>dput()</code> function. Then you can simply copy/paste the output into an email and send it to your collaborator for example. This also very helpful when you ask a question on those QA sites such as <a href="https://stackoverflow.com/">StackOverflow</a> as they always want a reproducible example but at the same time will not download any files on there own computers. Once you share the <code>dput()</code> output, the recipient can simply copy/paste it into their own R console and recreate your data frame that way. Below I did the same. Simply copy/paste those two blocks of code into your console and you have those data sets ready.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">require</span>(tidyverse)</a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3">d1 &lt;-<span class="st"> </span><span class="kw">structure</span>(<span class="kw">list</span>(<span class="dt">Treatment =</span> <span class="kw">structure</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">.Label =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, </a>
<a class="sourceLine" id="cb2-4" title="4"><span class="st">&quot;c&quot;</span>), <span class="dt">class =</span> <span class="st">&quot;factor&quot;</span>), <span class="dt">Height_7days =</span> <span class="kw">c</span>(<span class="fl">0.241756922</span>, <span class="fl">0.017613771</span>, </a>
<a class="sourceLine" id="cb2-5" title="5"><span class="fl">0.913951358</span>), <span class="dt">Height.14days =</span> <span class="kw">c</span>(<span class="fl">0.557475118</span>, <span class="fl">0.115967094</span>, <span class="fl">0.276483941</span></a>
<a class="sourceLine" id="cb2-6" title="6">), <span class="dt">Height21days =</span> <span class="kw">c</span>(<span class="fl">0.882937228</span>, <span class="fl">0.664116205</span>, <span class="fl">0.110760574</span>), <span class="dt">Weight_7days =</span> <span class="kw">c</span>(<span class="fl">0.014404525</span>, </a>
<a class="sourceLine" id="cb2-7" title="7"><span class="fl">0.591611048</span>, <span class="fl">0.365071975</span>), <span class="dt">Weight..14days =</span> <span class="kw">c</span>(<span class="fl">0.365071975</span>, <span class="fl">0.46561814</span>, </a>
<a class="sourceLine" id="cb2-8" title="8"><span class="fl">0.943144072</span>), <span class="dt">Weight_21days =</span> <span class="kw">c</span>(<span class="fl">0.420476422</span>, <span class="fl">0.86572502</span>, <span class="fl">0.911250316</span></a>
<a class="sourceLine" id="cb2-9" title="9">)), <span class="dt">class =</span> <span class="st">&quot;data.frame&quot;</span>, <span class="dt">row.names =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="op">-</span>3L))</a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11">d2 &lt;-<span class="st"> </span><span class="kw">structure</span>(<span class="kw">list</span>(<span class="dt">Treatment =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>), <span class="dt">Height_7days =</span> <span class="kw">c</span>(<span class="fl">0.241756922</span>, </a>
<a class="sourceLine" id="cb2-12" title="12"><span class="fl">0.017613771</span>, <span class="fl">0.913951358</span>), <span class="st">`</span><span class="dt">Height 14days</span><span class="st">`</span> =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.557475118</span>, <span class="fl">0.115967094</span>, </a>
<a class="sourceLine" id="cb2-13" title="13"><span class="fl">0.276483941</span>), <span class="dt">Height21days =</span> <span class="kw">c</span>(<span class="fl">0.882937228</span>, <span class="fl">0.664116205</span>, <span class="fl">0.110760574</span></a>
<a class="sourceLine" id="cb2-14" title="14">), <span class="dt">Weight_7days =</span> <span class="kw">c</span>(<span class="fl">0.014404525</span>, <span class="fl">0.591611048</span>, <span class="fl">0.365071975</span>), <span class="st">`</span><span class="dt">Weight  14days</span><span class="st">`</span> =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.365071975</span>, </a>
<a class="sourceLine" id="cb2-15" title="15"><span class="fl">0.46561814</span>, <span class="fl">0.943144072</span>), <span class="dt">Weight_21days =</span> <span class="kw">c</span>(<span class="fl">0.420476422</span>, <span class="fl">0.86572502</span>, </a>
<a class="sourceLine" id="cb2-16" title="16"><span class="fl">0.911250316</span>)), <span class="dt">class =</span> <span class="kw">c</span>(<span class="st">&quot;spec_tbl_df&quot;</span>, <span class="st">&quot;tbl_df&quot;</span>, <span class="st">&quot;tbl&quot;</span>, <span class="st">&quot;data.frame&quot;</span></a>
<a class="sourceLine" id="cb2-17" title="17">), <span class="dt">row.names =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="op">-</span>3L), <span class="dt">spec =</span> <span class="kw">structure</span>(<span class="kw">list</span>(<span class="dt">cols =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb2-18" title="18">    <span class="dt">Treatment =</span> <span class="kw">structure</span>(<span class="kw">list</span>(), <span class="dt">class =</span> <span class="kw">c</span>(<span class="st">&quot;collector_character&quot;</span>, </a>
<a class="sourceLine" id="cb2-19" title="19">    <span class="st">&quot;collector&quot;</span>)), <span class="dt">Height_7days =</span> <span class="kw">structure</span>(<span class="kw">list</span>(), <span class="dt">class =</span> <span class="kw">c</span>(<span class="st">&quot;collector_double&quot;</span>, </a>
<a class="sourceLine" id="cb2-20" title="20">    <span class="st">&quot;collector&quot;</span>)), <span class="st">`</span><span class="dt">Height 14days</span><span class="st">`</span> =<span class="st"> </span><span class="kw">structure</span>(<span class="kw">list</span>(), <span class="dt">class =</span> <span class="kw">c</span>(<span class="st">&quot;collector_double&quot;</span>, </a>
<a class="sourceLine" id="cb2-21" title="21">    <span class="st">&quot;collector&quot;</span>)), <span class="dt">Height21days =</span> <span class="kw">structure</span>(<span class="kw">list</span>(), <span class="dt">class =</span> <span class="kw">c</span>(<span class="st">&quot;collector_double&quot;</span>, </a>
<a class="sourceLine" id="cb2-22" title="22">    <span class="st">&quot;collector&quot;</span>)), <span class="dt">Weight_7days =</span> <span class="kw">structure</span>(<span class="kw">list</span>(), <span class="dt">class =</span> <span class="kw">c</span>(<span class="st">&quot;collector_double&quot;</span>, </a>
<a class="sourceLine" id="cb2-23" title="23">    <span class="st">&quot;collector&quot;</span>)), <span class="st">`</span><span class="dt">Weight  14days</span><span class="st">`</span> =<span class="st"> </span><span class="kw">structure</span>(<span class="kw">list</span>(), <span class="dt">class =</span> <span class="kw">c</span>(<span class="st">&quot;collector_double&quot;</span>, </a>
<a class="sourceLine" id="cb2-24" title="24">    <span class="st">&quot;collector&quot;</span>)), <span class="dt">Weight_21days =</span> <span class="kw">structure</span>(<span class="kw">list</span>(), <span class="dt">class =</span> <span class="kw">c</span>(<span class="st">&quot;collector_double&quot;</span>, </a>
<a class="sourceLine" id="cb2-25" title="25">    <span class="st">&quot;collector&quot;</span>))), <span class="dt">default =</span> <span class="kw">structure</span>(<span class="kw">list</span>(), <span class="dt">class =</span> <span class="kw">c</span>(<span class="st">&quot;collector_guess&quot;</span>, </a>
<a class="sourceLine" id="cb2-26" title="26"><span class="st">&quot;collector&quot;</span>)), <span class="dt">skip =</span> <span class="dv">1</span>), <span class="dt">class =</span> <span class="st">&quot;col_spec&quot;</span>))</a>
<a class="sourceLine" id="cb2-27" title="27"></a>
<a class="sourceLine" id="cb2-28" title="28">d1</a>
<a class="sourceLine" id="cb2-29" title="29"><span class="co">#&gt;   Treatment Height_7days Height.14days Height21days Weight_7days Weight..14days Weight_21days</span></a>
<a class="sourceLine" id="cb2-30" title="30"><span class="co">#&gt; 1         a   0.24175692     0.5574751    0.8829372   0.01440452      0.3650720     0.4204764</span></a>
<a class="sourceLine" id="cb2-31" title="31"><span class="co">#&gt; 2         b   0.01761377     0.1159671    0.6641162   0.59161105      0.4656181     0.8657250</span></a>
<a class="sourceLine" id="cb2-32" title="32"><span class="co">#&gt; 3         c   0.91395136     0.2764839    0.1107606   0.36507197      0.9431441     0.9112503</span></a>
<a class="sourceLine" id="cb2-33" title="33"></a>
<a class="sourceLine" id="cb2-34" title="34">d2</a>
<a class="sourceLine" id="cb2-35" title="35"><span class="co">#&gt; # A tibble: 3 x 7</span></a>
<a class="sourceLine" id="cb2-36" title="36"><span class="co">#&gt;   Treatment Height_7days `Height 14days` Height21days Weight_7days `Weight  14days` Weight_21days</span></a>
<a class="sourceLine" id="cb2-37" title="37"><span class="co">#&gt;   &lt;chr&gt;            &lt;dbl&gt;           &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;            &lt;dbl&gt;         &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-38" title="38"><span class="co">#&gt; 1 a               0.242            0.557        0.883       0.0144            0.365         0.420</span></a>
<a class="sourceLine" id="cb2-39" title="39"><span class="co">#&gt; 2 b               0.0176           0.116        0.664       0.592             0.466         0.866</span></a>
<a class="sourceLine" id="cb2-40" title="40"><span class="co">#&gt; 3 c               0.914            0.276        0.111       0.365             0.943         0.911</span></a>
<a class="sourceLine" id="cb2-41" title="41"></a>
<a class="sourceLine" id="cb2-42" title="42"><span class="co"># the regex below in the extract() function is universal enough to match both scenarios (read.csv and read_csv)</span></a>
<a class="sourceLine" id="cb2-43" title="43"><span class="co"># there are also shorthand versions of this regex but I use this one as it is more clear to me</span></a>
<a class="sourceLine" id="cb2-44" title="44"><span class="co"># this is where I got the idea from: https://stackoverflow.com/questions/25925556/gather-multiple-sets-of-columns</span></a>
<a class="sourceLine" id="cb2-45" title="45"><span class="co"># see also ?regex </span></a>
<a class="sourceLine" id="cb2-46" title="46"></a>
<a class="sourceLine" id="cb2-47" title="47"><span class="co"># run each line individually to see what the function are doing</span></a>
<a class="sourceLine" id="cb2-48" title="48">d1 <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">names_to =</span>  <span class="st">&quot;key&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;value&quot;</span>, <span class="op">-</span><span class="st"> </span>Treatment) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-49" title="49"><span class="st">  </span><span class="kw">extract</span>(key, <span class="kw">c</span>(<span class="st">&quot;parameter&quot;</span>, <span class="st">&quot;Days&quot;</span>), <span class="st">&quot;([[:alpha:]]+)[[:space:][:punct:]]*([[:digit:]]+)&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-50" title="50"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> parameter, <span class="dt">values_from =</span> value)</a>
<a class="sourceLine" id="cb2-51" title="51"><span class="co">#&gt; # A tibble: 9 x 4</span></a>
<a class="sourceLine" id="cb2-52" title="52"><span class="co">#&gt;   Treatment Days  Height Weight</span></a>
<a class="sourceLine" id="cb2-53" title="53"><span class="co">#&gt;   &lt;fct&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-54" title="54"><span class="co">#&gt; 1 a         7     0.242  0.0144</span></a>
<a class="sourceLine" id="cb2-55" title="55"><span class="co">#&gt; 2 a         14    0.557  0.365 </span></a>
<a class="sourceLine" id="cb2-56" title="56"><span class="co">#&gt; 3 a         21    0.883  0.420 </span></a>
<a class="sourceLine" id="cb2-57" title="57"><span class="co">#&gt; 4 b         7     0.0176 0.592 </span></a>
<a class="sourceLine" id="cb2-58" title="58"><span class="co">#&gt; 5 b         14    0.116  0.466 </span></a>
<a class="sourceLine" id="cb2-59" title="59"><span class="co">#&gt; 6 b         21    0.664  0.866 </span></a>
<a class="sourceLine" id="cb2-60" title="60"><span class="co">#&gt; 7 c         7     0.914  0.365 </span></a>
<a class="sourceLine" id="cb2-61" title="61"><span class="co">#&gt; 8 c         14    0.276  0.943 </span></a>
<a class="sourceLine" id="cb2-62" title="62"><span class="co">#&gt; 9 c         21    0.111  0.911</span></a>
<a class="sourceLine" id="cb2-63" title="63"></a>
<a class="sourceLine" id="cb2-64" title="64">d2 <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">names_to =</span>  <span class="st">&quot;key&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;value&quot;</span>, <span class="op">-</span><span class="st"> </span>Treatment) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-65" title="65"><span class="st">  </span><span class="kw">extract</span>(key, <span class="kw">c</span>(<span class="st">&quot;parameter&quot;</span>, <span class="st">&quot;Days&quot;</span>), <span class="st">&quot;([[:alpha:]]+)[[:space:][:punct:]]*([[:digit:]]+)&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-66" title="66"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> parameter, <span class="dt">values_from =</span> value)</a>
<a class="sourceLine" id="cb2-67" title="67"><span class="co">#&gt; # A tibble: 9 x 4</span></a>
<a class="sourceLine" id="cb2-68" title="68"><span class="co">#&gt;   Treatment Days  Height Weight</span></a>
<a class="sourceLine" id="cb2-69" title="69"><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-70" title="70"><span class="co">#&gt; 1 a         7     0.242  0.0144</span></a>
<a class="sourceLine" id="cb2-71" title="71"><span class="co">#&gt; 2 a         14    0.557  0.365 </span></a>
<a class="sourceLine" id="cb2-72" title="72"><span class="co">#&gt; 3 a         21    0.883  0.420 </span></a>
<a class="sourceLine" id="cb2-73" title="73"><span class="co">#&gt; 4 b         7     0.0176 0.592 </span></a>
<a class="sourceLine" id="cb2-74" title="74"><span class="co">#&gt; 5 b         14    0.116  0.466 </span></a>
<a class="sourceLine" id="cb2-75" title="75"><span class="co">#&gt; 6 b         21    0.664  0.866 </span></a>
<a class="sourceLine" id="cb2-76" title="76"><span class="co">#&gt; 7 c         7     0.914  0.365 </span></a>
<a class="sourceLine" id="cb2-77" title="77"><span class="co">#&gt; 8 c         14    0.276  0.943 </span></a>
<a class="sourceLine" id="cb2-78" title="78"><span class="co">#&gt; 9 c         21    0.111  0.911</span></a></code></pre></div>
<p>Here is another regex example how to clean up messy files (example data from Tomas):</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">require</span>(tidyverse)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">require</span>(lubridate)</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4">d3 &lt;-<span class="st"> </span><span class="kw">structure</span>(<span class="kw">list</span>(<span class="dt">X1 =</span> <span class="kw">c</span>(<span class="st">&quot;01-01-01&quot;</span>, <span class="st">&quot;01-02-01&quot;</span>, <span class="st">&quot;01-03-01&quot;</span>, <span class="st">&quot;01-04-01&quot;</span>, </a>
<a class="sourceLine" id="cb3-5" title="5"><span class="st">&quot;01-05-01&quot;</span>, <span class="st">&quot;01-06-01&quot;</span>, <span class="st">&quot;01-07-01&quot;</span>, <span class="st">&quot;01-08-01&quot;</span>, <span class="st">&quot;01-09-01&quot;</span>, <span class="st">&quot;01-10-01&quot;</span>, </a>
<a class="sourceLine" id="cb3-6" title="6"><span class="st">&quot;01-11-01&quot;</span>, <span class="st">&quot;01-12-01&quot;</span>, <span class="st">&quot;01-01-02&quot;</span>, <span class="st">&quot;01-02-02&quot;</span>, <span class="st">&quot;01-03-02&quot;</span>, <span class="st">&quot;01-04-02&quot;</span>, </a>
<a class="sourceLine" id="cb3-7" title="7"><span class="st">&quot;01-05-02&quot;</span>, <span class="st">&quot;01-06-02&quot;</span>, <span class="st">&quot;01-07-02&quot;</span>, <span class="st">&quot;01-08-02&quot;</span>, <span class="st">&quot;01-09-02&quot;</span>), </a>
<a class="sourceLine" id="cb3-8" title="8">    <span class="dt">NAICS =</span> <span class="kw">c</span>(<span class="st">&quot;11&quot;</span>, <span class="st">&quot;11A&quot;</span>, <span class="st">&quot;22&quot;</span>, <span class="st">&quot;23C&quot;</span>, <span class="st">&quot;31-33&quot;</span>, <span class="st">&quot;31-33&quot;</span>, <span class="st">&quot;31-33&quot;</span>, </a>
<a class="sourceLine" id="cb3-9" title="9">    <span class="st">&quot;31-33&quot;</span>, <span class="st">&quot;31-33&quot;</span>, <span class="st">&quot;31-33&quot;</span>, <span class="st">&quot;31-33&quot;</span>, <span class="st">&quot;41&quot;</span>, <span class="st">&quot;51&quot;</span>, <span class="st">&quot;61&quot;</span>, <span class="st">&quot;51C&quot;</span>, </a>
<a class="sourceLine" id="cb3-10" title="10">    <span class="st">&quot;71&quot;</span>, <span class="st">&quot;81&quot;</span>, <span class="st">&quot;91&quot;</span>, <span class="st">&quot;91&quot;</span>, <span class="st">&quot;91&quot;</span>, <span class="st">&quot;91&quot;</span>), <span class="dt">Persons =</span> <span class="kw">c</span>(<span class="st">&quot;100F&quot;</span>, </a>
<a class="sourceLine" id="cb3-11" title="11">    <span class="st">&quot;120A&quot;</span>, <span class="st">&quot;96&quot;</span>, <span class="st">&quot;19&quot;</span>, <span class="st">&quot;89&quot;</span>, <span class="st">&quot;54&quot;</span>, <span class="st">&quot;81&quot;</span>, <span class="st">&quot;92&quot;</span>, <span class="st">&quot;86&quot;</span>, <span class="st">&quot;57B&quot;</span>, </a>
<a class="sourceLine" id="cb3-12" title="12">    <span class="st">&quot;76&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;91&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;30&quot;</span>, <span class="st">&quot;77&quot;</span>, <span class="st">&quot;22&quot;</span>, <span class="st">&quot;32&quot;</span>, <span class="st">&quot;77&quot;</span>, <span class="st">&quot;48&quot;</span>, </a>
<a class="sourceLine" id="cb3-13" title="13">    <span class="st">&quot;32&quot;</span>), <span class="dt">Wages =</span> <span class="kw">c</span>(<span class="st">&quot;..&quot;</span>, <span class="st">&quot;N/A&quot;</span>, <span class="st">&quot;120&quot;</span>, <span class="st">&quot;80&quot;</span>, <span class="st">&quot;na&quot;</span>, <span class="ot">NA</span>, <span class="st">&quot;Na&quot;</span>, </a>
<a class="sourceLine" id="cb3-14" title="14">    <span class="st">&quot;30&quot;</span>, <span class="st">&quot;nA&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;17&quot;</span>, <span class="st">&quot;83&quot;</span>, <span class="st">&quot;36&quot;</span>, <span class="st">&quot;N/A&quot;</span>, <span class="st">&quot;43&quot;</span>, <span class="st">&quot;..&quot;</span>, <span class="st">&quot;14&quot;</span>, </a>
<a class="sourceLine" id="cb3-15" title="15">    <span class="st">&quot;11&quot;</span>, <span class="st">&quot;N/A&quot;</span>, <span class="st">&quot;..&quot;</span>, <span class="st">&quot;77&quot;</span>)), <span class="dt">class =</span> <span class="kw">c</span>(<span class="st">&quot;spec_tbl_df&quot;</span>, <span class="st">&quot;tbl_df&quot;</span>, </a>
<a class="sourceLine" id="cb3-16" title="16"><span class="st">&quot;tbl&quot;</span>, <span class="st">&quot;data.frame&quot;</span>), <span class="dt">row.names =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="op">-</span>21L), <span class="dt">spec =</span> <span class="kw">structure</span>(<span class="kw">list</span>(</a>
<a class="sourceLine" id="cb3-17" title="17">    <span class="dt">cols =</span> <span class="kw">list</span>(<span class="dt">X1 =</span> <span class="kw">structure</span>(<span class="kw">list</span>(), <span class="dt">class =</span> <span class="kw">c</span>(<span class="st">&quot;collector_character&quot;</span>, </a>
<a class="sourceLine" id="cb3-18" title="18">    <span class="st">&quot;collector&quot;</span>)), <span class="dt">NAICS =</span> <span class="kw">structure</span>(<span class="kw">list</span>(), <span class="dt">class =</span> <span class="kw">c</span>(<span class="st">&quot;collector_character&quot;</span>, </a>
<a class="sourceLine" id="cb3-19" title="19">    <span class="st">&quot;collector&quot;</span>)), <span class="dt">Persons =</span> <span class="kw">structure</span>(<span class="kw">list</span>(), <span class="dt">class =</span> <span class="kw">c</span>(<span class="st">&quot;collector_character&quot;</span>, </a>
<a class="sourceLine" id="cb3-20" title="20">    <span class="st">&quot;collector&quot;</span>)), <span class="dt">Wages =</span> <span class="kw">structure</span>(<span class="kw">list</span>(), <span class="dt">class =</span> <span class="kw">c</span>(<span class="st">&quot;collector_character&quot;</span>, </a>
<a class="sourceLine" id="cb3-21" title="21">    <span class="st">&quot;collector&quot;</span>))), <span class="dt">default =</span> <span class="kw">structure</span>(<span class="kw">list</span>(), <span class="dt">class =</span> <span class="kw">c</span>(<span class="st">&quot;collector_guess&quot;</span>, </a>
<a class="sourceLine" id="cb3-22" title="22">    <span class="st">&quot;collector&quot;</span>)), <span class="dt">skip =</span> <span class="dv">1</span>), <span class="dt">class =</span> <span class="st">&quot;col_spec&quot;</span>))</a></code></pre></div>
<p>Using <code>str_view()</code> we can see what the regex is matching. Then we can either <code>str_extract()</code> or <code>str_replace()</code>. If there is one simply pattern of what you want to keep, then use <code>str_extract()</code>. On the other hand sometimes it makes more sense to use <code>str_replace</code> (see example below).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">str_view</span>(d3<span class="op">$</span>NAICS, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d+&quot;</span>) <span class="co"># see the matches</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">str_extract</span>(d3<span class="op">$</span>NAICS, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d+&quot;</span>) <span class="co"># we can use str_extract here to pull out what we want</span></a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co"># we can apply the same logic here:</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="kw">str_view</span>(d3<span class="op">$</span>Persons, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d+&quot;</span>) <span class="co"># see the matches</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="kw">str_extract</span>(d3<span class="op">$</span>Persons, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d+&quot;</span>) <span class="co"># we can use str_extract here to pull out what we want</span></a>
<a class="sourceLine" id="cb4-7" title="7"></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co"># finding various types of NAs. Here it&#39;s better to identify a common pattern and replace it with nothing</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="kw">str_view</span>(d3<span class="op">$</span>Wages, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.+|[nN/aA]+&quot;</span>) <span class="co"># see the matches</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="kw">str_replace</span>(d3<span class="op">$</span>Wages, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.+|[nN/aA]+&quot;</span>, <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<p>Now this works for this data set, so let’s proceed and fix it up.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># clean data</span></a>
<a class="sourceLine" id="cb5-2" title="2">d3 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">Date =</span> X1) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="st">  </span><span class="co"># first I change `Date` to an actual date object using `ymd()` from the `lubridate` package</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date =</span> <span class="kw">ymd</span>(Date),</a>
<a class="sourceLine" id="cb5-6" title="6">         <span class="dt">NAICS =</span> <span class="kw">str_extract</span>(NAICS, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d+&quot;</span>),</a>
<a class="sourceLine" id="cb5-7" title="7">         <span class="dt">Persons =</span> <span class="kw">str_extract</span>(Persons, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d+&quot;</span>),</a>
<a class="sourceLine" id="cb5-8" title="8">         <span class="dt">Wages =</span> <span class="kw">str_replace</span>(Wages, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.+|[nN/aA]+&quot;</span>, <span class="st">&quot;&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="st">  </span><span class="co"># mutate_at will apply a function to specific variables</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="st">  </span><span class="co"># in this case we need to change from `character` to `double` (or numeric)</span></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="st">  </span><span class="co"># see `?mutate_at` for details</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="dt">.vars =</span> <span class="kw">vars</span>(NAICS, Persons, Wages), <span class="dt">.funs =</span> as.double) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="st">  </span><span class="co"># with `print` you can change how many rows you want to see (default is 10)</span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="dv">40</span>)</a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co">#&gt; # A tibble: 21 x 4</span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="co">#&gt;    Date       NAICS Persons Wages</span></a>
<a class="sourceLine" id="cb5-17" title="17"><span class="co">#&gt;    &lt;date&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb5-18" title="18"><span class="co">#&gt;  1 2001-01-01    11     100    NA</span></a>
<a class="sourceLine" id="cb5-19" title="19"><span class="co">#&gt;  2 2001-02-01    11     120    NA</span></a>
<a class="sourceLine" id="cb5-20" title="20"><span class="co">#&gt;  3 2001-03-01    22      96   120</span></a>
<a class="sourceLine" id="cb5-21" title="21"><span class="co">#&gt;  4 2001-04-01    23      19    80</span></a>
<a class="sourceLine" id="cb5-22" title="22"><span class="co">#&gt;  5 2001-05-01    31      89    NA</span></a>
<a class="sourceLine" id="cb5-23" title="23"><span class="co">#&gt;  6 2001-06-01    31      54    NA</span></a>
<a class="sourceLine" id="cb5-24" title="24"><span class="co">#&gt;  7 2001-07-01    31      81    NA</span></a>
<a class="sourceLine" id="cb5-25" title="25"><span class="co">#&gt;  8 2001-08-01    31      92    30</span></a>
<a class="sourceLine" id="cb5-26" title="26"><span class="co">#&gt;  9 2001-09-01    31      86    NA</span></a>
<a class="sourceLine" id="cb5-27" title="27"><span class="co">#&gt; 10 2001-10-01    31      57    15</span></a>
<a class="sourceLine" id="cb5-28" title="28"><span class="co">#&gt; 11 2001-11-01    31      76    17</span></a>
<a class="sourceLine" id="cb5-29" title="29"><span class="co">#&gt; 12 2001-12-01    41       5    83</span></a>
<a class="sourceLine" id="cb5-30" title="30"><span class="co">#&gt; 13 2001-01-02    51      91    36</span></a>
<a class="sourceLine" id="cb5-31" title="31"><span class="co">#&gt; 14 2001-02-02    61       7    NA</span></a>
<a class="sourceLine" id="cb5-32" title="32"><span class="co">#&gt; 15 2001-03-02    51      30    43</span></a>
<a class="sourceLine" id="cb5-33" title="33"><span class="co">#&gt; 16 2001-04-02    71      77    NA</span></a>
<a class="sourceLine" id="cb5-34" title="34"><span class="co">#&gt; 17 2001-05-02    81      22    14</span></a>
<a class="sourceLine" id="cb5-35" title="35"><span class="co">#&gt; 18 2001-06-02    91      32    11</span></a>
<a class="sourceLine" id="cb5-36" title="36"><span class="co">#&gt; 19 2001-07-02    91      77    NA</span></a>
<a class="sourceLine" id="cb5-37" title="37"><span class="co">#&gt; 20 2001-08-02    91      48    NA</span></a>
<a class="sourceLine" id="cb5-38" title="38"><span class="co">#&gt; 21 2001-09-02    91      32    77</span></a></code></pre></div>
<p>We also talked about the <code>fill()</code> function from the <code>dplyr</code> package. Very handy function! Put it in your tool box! Here is an example:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">(d4 &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Country =</span> <span class="kw">c</span>(<span class="st">&quot;Western Canada&quot;</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="st">&quot;Central Canada&quot;</span>, <span class="ot">NA</span>, <span class="ot">NA</span>),</a>
<a class="sourceLine" id="cb6-2" title="2">              <span class="dt">Province =</span> <span class="kw">c</span>(<span class="st">&quot;BC&quot;</span>, <span class="st">&quot;AB&quot;</span>, <span class="st">&quot;SK&quot;</span>,<span class="st">&quot;MB&quot;</span>, <span class="st">&quot;ON&quot;</span>, <span class="st">&quot;QC&quot;</span>)))</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">#&gt; # A tibble: 6 x 2</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">#&gt;   Country        Province</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">#&gt;   &lt;chr&gt;          &lt;chr&gt;   </span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">#&gt; 1 Western Canada BC      </span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">#&gt; 2 &lt;NA&gt;           AB      </span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">#&gt; 3 &lt;NA&gt;           SK      </span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">#&gt; 4 Central Canada MB      </span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">#&gt; 5 &lt;NA&gt;           ON      </span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="co">#&gt; 6 &lt;NA&gt;           QC</span></a>
<a class="sourceLine" id="cb6-12" title="12"></a>
<a class="sourceLine" id="cb6-13" title="13">d4 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="st">  </span><span class="kw">fill</span>(Country)</a>
<a class="sourceLine" id="cb6-15" title="15"><span class="co">#&gt; # A tibble: 6 x 2</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="co">#&gt;   Country        Province</span></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="co">#&gt;   &lt;chr&gt;          &lt;chr&gt;   </span></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="co">#&gt; 1 Western Canada BC      </span></a>
<a class="sourceLine" id="cb6-19" title="19"><span class="co">#&gt; 2 Western Canada AB      </span></a>
<a class="sourceLine" id="cb6-20" title="20"><span class="co">#&gt; 3 Western Canada SK      </span></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="co">#&gt; 4 Central Canada MB      </span></a>
<a class="sourceLine" id="cb6-22" title="22"><span class="co">#&gt; 5 Central Canada ON      </span></a>
<a class="sourceLine" id="cb6-23" title="23"><span class="co">#&gt; 6 Central Canada QC</span></a></code></pre></div>
<p>Now I want to share another great data set with you. You can find it in the <code>gapminder</code> package:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">require</span>(gapminder)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co">#&gt; Loading required package: gapminder</span></a></code></pre></div>
<p>To change things up a bit let’s watch a quick movie about this data set: <a href="https://www.youtube.com/watch?v=jbkSRLYSojo" class="uri">https://www.youtube.com/watch?v=jbkSRLYSojo</a></p>
<p>The gapminder data set is a subset of the data presented in the video. Now, it’s your turn again! Take the data set and turn it upside down.</p>
</div>
<div id="analysis-of-variance" class="section level1">
<h1><span class="header-section-number">2</span> Analysis of variance</h1>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">m1 &lt;-<span class="st"> </span><span class="kw">aov</span>(lifeExp <span class="op">~</span><span class="st"> </span>continent, <span class="dt">data =</span> gapminder)</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">summary</span>(m1) <span class="co"># Significant continent effect</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="co">#&gt;               Df Sum Sq Mean Sq F value Pr(&gt;F)    </span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="co">#&gt; continent      4 139343   34836   408.7 &lt;2e-16 ***</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co">#&gt; Residuals   1699 144805      85                   </span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb8-8" title="8"></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="co"># emmeans package great for doing posthoc comparisons</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="kw">require</span>(emmeans)</a>
<a class="sourceLine" id="cb8-11" title="11"><span class="co">#&gt; Loading required package: emmeans</span></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="co">#&gt; Welcome to emmeans.</span></a>
<a class="sourceLine" id="cb8-13" title="13"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co"> -- Important change from versions &lt;= 1.41:</span></a>
<a class="sourceLine" id="cb8-14" title="14"><span class="co">#&gt;     Indicator predictors are now treated as 2-level factors by default.</span></a>
<a class="sourceLine" id="cb8-15" title="15"><span class="co">#&gt;     To revert to old behavior, use emm_options(cov.keep = character(0))</span></a>
<a class="sourceLine" id="cb8-16" title="16"></a>
<a class="sourceLine" id="cb8-17" title="17">(mean_comparisons &lt;-<span class="st"> </span><span class="kw">emmeans</span>(m1, <span class="st">&quot;continent&quot;</span>))</a>
<a class="sourceLine" id="cb8-18" title="18"><span class="co">#&gt;  continent emmean    SE   df lower.CL upper.CL</span></a>
<a class="sourceLine" id="cb8-19" title="19"><span class="co">#&gt;  Africa      48.9 0.370 1699     48.1     49.6</span></a>
<a class="sourceLine" id="cb8-20" title="20"><span class="co">#&gt;  Americas    64.7 0.533 1699     63.6     65.7</span></a>
<a class="sourceLine" id="cb8-21" title="21"><span class="co">#&gt;  Asia        60.1 0.464 1699     59.2     61.0</span></a>
<a class="sourceLine" id="cb8-22" title="22"><span class="co">#&gt;  Europe      71.9 0.487 1699     70.9     72.9</span></a>
<a class="sourceLine" id="cb8-23" title="23"><span class="co">#&gt;  Oceania     74.3 1.884 1699     70.6     78.0</span></a>
<a class="sourceLine" id="cb8-24" title="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-25" title="25"><span class="co">#&gt; Confidence level used: 0.95</span></a>
<a class="sourceLine" id="cb8-26" title="26">(tukey_comparisons &lt;-<span class="st"> </span><span class="kw">CLD</span>(mean_comparisons, <span class="dt">Letters =</span> letters))</a>
<a class="sourceLine" id="cb8-27" title="27"><span class="co">#&gt; Warning: &#39;CLD&#39; will be deprecated. Its use is discouraged.</span></a>
<a class="sourceLine" id="cb8-28" title="28"><span class="co">#&gt; See &#39;? CLD&#39; for an explanation. Use &#39;pwpp&#39; or &#39;multcomp::cld&#39; instead.</span></a>
<a class="sourceLine" id="cb8-29" title="29"><span class="co">#&gt;  continent emmean    SE   df lower.CL upper.CL .group</span></a>
<a class="sourceLine" id="cb8-30" title="30"><span class="co">#&gt;  Africa      48.9 0.370 1699     48.1     49.6  a    </span></a>
<a class="sourceLine" id="cb8-31" title="31"><span class="co">#&gt;  Asia        60.1 0.464 1699     59.2     61.0   b   </span></a>
<a class="sourceLine" id="cb8-32" title="32"><span class="co">#&gt;  Americas    64.7 0.533 1699     63.6     65.7    c  </span></a>
<a class="sourceLine" id="cb8-33" title="33"><span class="co">#&gt;  Europe      71.9 0.487 1699     70.9     72.9     d </span></a>
<a class="sourceLine" id="cb8-34" title="34"><span class="co">#&gt;  Oceania     74.3 1.884 1699     70.6     78.0     d </span></a>
<a class="sourceLine" id="cb8-35" title="35"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-36" title="36"><span class="co">#&gt; Confidence level used: 0.95 </span></a>
<a class="sourceLine" id="cb8-37" title="37"><span class="co">#&gt; P value adjustment: tukey method for comparing a family of 5 estimates </span></a>
<a class="sourceLine" id="cb8-38" title="38"><span class="co">#&gt; significance level used: alpha = 0.05</span></a>
<a class="sourceLine" id="cb8-39" title="39">tukey_comparisons<span class="op">$</span>.group2 &lt;-<span class="st"> </span><span class="kw">trimws</span>(tukey_comparisons<span class="op">$</span>.group)</a>
<a class="sourceLine" id="cb8-40" title="40"></a>
<a class="sourceLine" id="cb8-41" title="41"><span class="kw">ggplot</span>(tukey_comparisons, <span class="kw">aes</span>(<span class="dt">x =</span> continent, <span class="dt">y =</span> emmean)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-42" title="42"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower.CL, <span class="dt">ymax =</span> upper.CL)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-43" title="43"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> continent, <span class="dt">y =</span> upper.CL <span class="op">+</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">label =</span> .group2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-44" title="44"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Continent&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Mean Life Expectancy&quot;</span>)</a></code></pre></div>
<p><img src="day3_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">ggplot</span>(tukey_comparisons, <span class="kw">aes</span>(<span class="dt">x =</span> continent, <span class="dt">y =</span> emmean)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">fill =</span> <span class="st">&quot;grey60&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower.CL, <span class="dt">ymax =</span> upper.CL), <span class="dt">width =</span> <span class="fl">0.25</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> continent, <span class="dt">y =</span> upper.CL <span class="op">+</span><span class="st"> </span><span class="dv">3</span>, <span class="dt">label =</span> .group2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Continent&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Mean Life Expectancy&quot;</span>)</a></code></pre></div>
<p><img src="day3_files/figure-html/unnamed-chunk-9-2.png" width="672" /></p>
</div>
<div id="linear-regression" class="section level1">
<h1><span class="header-section-number">3</span> Linear regression</h1>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">gapminder <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="st">  </span><span class="kw">filter</span>(continent <span class="op">==</span><span class="st"> &quot;Europe&quot;</span>) -&gt;<span class="st"> </span>europe </a>
<a class="sourceLine" id="cb10-3" title="3">  </a>
<a class="sourceLine" id="cb10-4" title="4">m2 &lt;-<span class="st"> </span><span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span>gdpPercap, europe)</a>
<a class="sourceLine" id="cb10-5" title="5">m2</a>
<a class="sourceLine" id="cb10-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="co">#&gt; lm(formula = lifeExp ~ gdpPercap, data = europe)</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="co">#&gt; (Intercept)    gdpPercap  </span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="co">#&gt;   6.534e+01    4.535e-04</span></a>
<a class="sourceLine" id="cb10-13" title="13"></a>
<a class="sourceLine" id="cb10-14" title="14"><span class="kw">summary</span>(m2)</a>
<a class="sourceLine" id="cb10-15" title="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="co">#&gt; lm(formula = lifeExp ~ gdpPercap, data = europe)</span></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="co">#&gt; Residuals:</span></a>
<a class="sourceLine" id="cb10-20" title="20"><span class="co">#&gt;      Min       1Q   Median       3Q      Max </span></a>
<a class="sourceLine" id="cb10-21" title="21"><span class="co">#&gt; -22.6504  -1.2783   0.1333   2.0302   8.3884 </span></a>
<a class="sourceLine" id="cb10-22" title="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-23" title="23"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb10-24" title="24"><span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span></a>
<a class="sourceLine" id="cb10-25" title="25"><span class="co">#&gt; (Intercept) 6.534e+01  3.303e-01  197.82   &lt;2e-16 ***</span></a>
<a class="sourceLine" id="cb10-26" title="26"><span class="co">#&gt; gdpPercap   4.534e-04  1.918e-05   23.64   &lt;2e-16 ***</span></a>
<a class="sourceLine" id="cb10-27" title="27"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb10-28" title="28"><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb10-29" title="29"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-30" title="30"><span class="co">#&gt; Residual standard error: 3.399 on 358 degrees of freedom</span></a>
<a class="sourceLine" id="cb10-31" title="31"><span class="co">#&gt; Multiple R-squared:  0.6096, Adjusted R-squared:  0.6085 </span></a>
<a class="sourceLine" id="cb10-32" title="32"><span class="co">#&gt; F-statistic: 559.1 on 1 and 358 DF,  p-value: &lt; 2.2e-16</span></a>
<a class="sourceLine" id="cb10-33" title="33"></a>
<a class="sourceLine" id="cb10-34" title="34"><span class="kw">ggplot</span>(europe, <span class="kw">aes</span>(gdpPercap, lifeExp)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-35" title="35"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb10-36" title="36"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-37" title="37"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;GDP per capita&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Life Expectancy&quot;</span>)</a></code></pre></div>
<p><img src="day3_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># predict some new data from the model</span></a>
<a class="sourceLine" id="cb11-2" title="2">new_data &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">gdpPercap =</span> <span class="kw">c</span>(<span class="dv">20000</span>, <span class="dv">30000</span>, <span class="dv">40000</span>, <span class="dv">50000</span>))</a>
<a class="sourceLine" id="cb11-3" title="3">new_data</a>
<a class="sourceLine" id="cb11-4" title="4"><span class="co">#&gt; # A tibble: 4 x 1</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="co">#&gt;   gdpPercap</span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co">#&gt;       &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="co">#&gt; 1     20000</span></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="co">#&gt; 2     30000</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="co">#&gt; 3     40000</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="co">#&gt; 4     50000</span></a>
<a class="sourceLine" id="cb11-11" title="11"></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="kw">predict</span>(m2, new_data, <span class="dt">interval =</span> <span class="st">&quot;prediction&quot;</span>)</a>
<a class="sourceLine" id="cb11-13" title="13"><span class="co">#&gt;        fit      lwr      upr</span></a>
<a class="sourceLine" id="cb11-14" title="14"><span class="co">#&gt; 1 74.41151 67.71368 81.10934</span></a>
<a class="sourceLine" id="cb11-15" title="15"><span class="co">#&gt; 2 78.94602 72.22587 85.66618</span></a>
<a class="sourceLine" id="cb11-16" title="16"><span class="co">#&gt; 3 83.48053 76.71706 90.24401</span></a>
<a class="sourceLine" id="cb11-17" title="17"><span class="co">#&gt; 4 88.01505 81.18767 94.84243</span></a></code></pre></div>
</div>
<div id="multiple-models" class="section level1">
<h1><span class="header-section-number">4</span> Multiple models</h1>
<p>Also check out the chapter <a href="https://r4ds.had.co.nz/many-models.html">Many Models</a> in the <a href="https://r4ds.had.co.nz/">R for Data Science</a> book.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">gapminder <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country, continent) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="st">  </span><span class="kw">nest</span>() -&gt;<span class="st"> </span>gapm_country</a>
<a class="sourceLine" id="cb12-4" title="4">gapm_country</a>
<a class="sourceLine" id="cb12-5" title="5"><span class="co">#&gt; # A tibble: 142 x 3</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="co">#&gt; # Groups:   country, continent [710]</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="co">#&gt;    country     continent           data</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;list&lt;df[,4]&gt;&gt;</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#&gt;  1 Afghanistan Asia            [12 x 4]</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">#&gt;  2 Albania     Europe          [12 x 4]</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="co">#&gt;  3 Algeria     Africa          [12 x 4]</span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="co">#&gt;  4 Angola      Africa          [12 x 4]</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="co">#&gt;  5 Argentina   Americas        [12 x 4]</span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="co">#&gt;  6 Australia   Oceania         [12 x 4]</span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="co">#&gt;  7 Austria     Europe          [12 x 4]</span></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="co">#&gt;  8 Bahrain     Asia            [12 x 4]</span></a>
<a class="sourceLine" id="cb12-17" title="17"><span class="co">#&gt;  9 Bangladesh  Asia            [12 x 4]</span></a>
<a class="sourceLine" id="cb12-18" title="18"><span class="co">#&gt; 10 Belgium     Europe          [12 x 4]</span></a>
<a class="sourceLine" id="cb12-19" title="19"><span class="co">#&gt; # ... with 132 more rows</span></a>
<a class="sourceLine" id="cb12-20" title="20"></a>
<a class="sourceLine" id="cb12-21" title="21"><span class="co"># And then run the lm function only once!</span></a>
<a class="sourceLine" id="cb12-22" title="22">gapm_country <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-23" title="23"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> purrr<span class="op">::</span><span class="kw">map</span>(data, <span class="op">~</span><span class="st"> </span><span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span>year, <span class="dt">data =</span> .x))) -&gt;<span class="st"> </span>country_model</a>
<a class="sourceLine" id="cb12-24" title="24">country_model</a>
<a class="sourceLine" id="cb12-25" title="25"><span class="co">#&gt; # A tibble: 142 x 4</span></a>
<a class="sourceLine" id="cb12-26" title="26"><span class="co">#&gt; # Groups:   country, continent [710]</span></a>
<a class="sourceLine" id="cb12-27" title="27"><span class="co">#&gt;    country     continent           data model </span></a>
<a class="sourceLine" id="cb12-28" title="28"><span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;list&lt;df[,4]&gt;&gt; &lt;list&gt;</span></a>
<a class="sourceLine" id="cb12-29" title="29"><span class="co">#&gt;  1 Afghanistan Asia            [12 x 4] &lt;lm&gt;  </span></a>
<a class="sourceLine" id="cb12-30" title="30"><span class="co">#&gt;  2 Albania     Europe          [12 x 4] &lt;lm&gt;  </span></a>
<a class="sourceLine" id="cb12-31" title="31"><span class="co">#&gt;  3 Algeria     Africa          [12 x 4] &lt;lm&gt;  </span></a>
<a class="sourceLine" id="cb12-32" title="32"><span class="co">#&gt;  4 Angola      Africa          [12 x 4] &lt;lm&gt;  </span></a>
<a class="sourceLine" id="cb12-33" title="33"><span class="co">#&gt;  5 Argentina   Americas        [12 x 4] &lt;lm&gt;  </span></a>
<a class="sourceLine" id="cb12-34" title="34"><span class="co">#&gt;  6 Australia   Oceania         [12 x 4] &lt;lm&gt;  </span></a>
<a class="sourceLine" id="cb12-35" title="35"><span class="co">#&gt;  7 Austria     Europe          [12 x 4] &lt;lm&gt;  </span></a>
<a class="sourceLine" id="cb12-36" title="36"><span class="co">#&gt;  8 Bahrain     Asia            [12 x 4] &lt;lm&gt;  </span></a>
<a class="sourceLine" id="cb12-37" title="37"><span class="co">#&gt;  9 Bangladesh  Asia            [12 x 4] &lt;lm&gt;  </span></a>
<a class="sourceLine" id="cb12-38" title="38"><span class="co">#&gt; 10 Belgium     Europe          [12 x 4] &lt;lm&gt;  </span></a>
<a class="sourceLine" id="cb12-39" title="39"><span class="co">#&gt; # ... with 132 more rows</span></a>
<a class="sourceLine" id="cb12-40" title="40"></a>
<a class="sourceLine" id="cb12-41" title="41"><span class="co"># Using the `tidy()` function from the `broom` package we can see each model result in one data frame!</span></a>
<a class="sourceLine" id="cb12-42" title="42">country_model <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-43" title="43"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tidy_models =</span> purrr<span class="op">::</span><span class="kw">map</span>(model, broom<span class="op">::</span>tidy)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># replace with `broom::augment` and `broom::glance`</span></a>
<a class="sourceLine" id="cb12-44" title="44"><span class="st">  </span><span class="kw">unnest</span>(tidy_models) -&gt;<span class="st"> </span>model_summary</a>
<a class="sourceLine" id="cb12-45" title="45">model_summary</a>
<a class="sourceLine" id="cb12-46" title="46"><span class="co">#&gt; # A tibble: 284 x 9</span></a>
<a class="sourceLine" id="cb12-47" title="47"><span class="co">#&gt; # Groups:   country, continent [710]</span></a>
<a class="sourceLine" id="cb12-48" title="48"><span class="co">#&gt;    country     continent           data model  term         estimate std.error statistic  p.value</span></a>
<a class="sourceLine" id="cb12-49" title="49"><span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;list&lt;df[,4]&gt;&gt; &lt;list&gt; &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb12-50" title="50"><span class="co">#&gt;  1 Afghanistan Asia            [12 x 4] &lt;lm&gt;   (Intercept)  -508.     40.5        -12.5  1.93e- 7</span></a>
<a class="sourceLine" id="cb12-51" title="51"><span class="co">#&gt;  2 Afghanistan Asia            [12 x 4] &lt;lm&gt;   year            0.275   0.0205      13.5  9.84e- 8</span></a>
<a class="sourceLine" id="cb12-52" title="52"><span class="co">#&gt;  3 Albania     Europe          [12 x 4] &lt;lm&gt;   (Intercept)  -594.     65.7         -9.05 3.94e- 6</span></a>
<a class="sourceLine" id="cb12-53" title="53"><span class="co">#&gt;  4 Albania     Europe          [12 x 4] &lt;lm&gt;   year            0.335   0.0332      10.1  1.46e- 6</span></a>
<a class="sourceLine" id="cb12-54" title="54"><span class="co">#&gt;  5 Algeria     Africa          [12 x 4] &lt;lm&gt;   (Intercept) -1068.     43.8        -24.4  3.07e-10</span></a>
<a class="sourceLine" id="cb12-55" title="55"><span class="co">#&gt;  6 Algeria     Africa          [12 x 4] &lt;lm&gt;   year            0.569   0.0221      25.7  1.81e-10</span></a>
<a class="sourceLine" id="cb12-56" title="56"><span class="co">#&gt;  7 Angola      Africa          [12 x 4] &lt;lm&gt;   (Intercept)  -377.     46.6         -8.08 1.08e- 5</span></a>
<a class="sourceLine" id="cb12-57" title="57"><span class="co">#&gt;  8 Angola      Africa          [12 x 4] &lt;lm&gt;   year            0.209   0.0235       8.90 4.59e- 6</span></a>
<a class="sourceLine" id="cb12-58" title="58"><span class="co">#&gt;  9 Argentina   Americas        [12 x 4] &lt;lm&gt;   (Intercept)  -390.      9.68       -40.3  2.14e-12</span></a>
<a class="sourceLine" id="cb12-59" title="59"><span class="co">#&gt; 10 Argentina   Americas        [12 x 4] &lt;lm&gt;   year            0.232   0.00489     47.4  4.22e-13</span></a>
<a class="sourceLine" id="cb12-60" title="60"><span class="co">#&gt; # ... with 274 more rows</span></a></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">write_csv</span>(model_summary, <span class="st">&quot;model_summary&quot;</span>)</a></code></pre></div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
